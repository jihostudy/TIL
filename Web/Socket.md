# μ†μΌ“

## μ •μ λ° νΉμ§•(Socket)

μ‹¤μ‹κ°„ μ–‘λ°©ν–¥ ν†µμ‹ μ„ μ„ν•΄ μ›Ή μ• ν”λ¦¬μΌ€μ΄μ…κ³Ό μ„λ²„ κ°„μ μ§€μ†μ μΈ μ—°κ²°μ„ μ κ³µν•λ” ν”„λ΅ν† μ½λ΅ μ—°κ²°μ΄ μ μ§€λλ” λ™μ• μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ μμ‹λ΅ λ°μ΄ν„°λ¥Ό μ£Όκ³ λ°›μ„ μ μλ‹¤λ” νΉμ§•μ΄ μλ‹¤.

- μ‹¤μ‹κ°„ λ°μ΄ν„° μ „μ†΅
    
    μ–Έμ λ“ μ§€ μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ λ°μ΄ν„°λ¥Ό μ†΅μμ‹ ν•  μ μλ‹¤.
    
- μ—°κ²° μ μ§€ λΉ„μ© μ κ°
    
    μ”μ²­μ„ ν• λ•λ§λ‹¤ μ„λ²„μ™€ μƒλ΅μ΄ μ—°κ²°μ„ ν•΄μ•Όν•λ” HTTPμ™€ λ‹¬λ¦¬, μ›Ή μ†μΌ“μ€ ν• λ²μ μ—°κ²° μ„¤μ • ν›„ μ§€μ†μ μΌλ΅ λ°μ΄ν„°λ¥Ό κµν™ν•  μ μμ–΄μ„ λ„¤νΈμ›ν¬ λ¶€ν•μ™€ μ§€μ—° μ‹κ°„μ„ μ¤„μΌ μ μλ‹¤.
    
- μ–‘λ°©ν–¥ ν†µμ‹ 
    
    ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ λ™μ‹μ— λ°μ΄ν„°λ¥Ό λ³΄λ‚Ό μ μλ‹¤.
    
- λ©”μ„Έμ§€ κ²½κ³„ μ΅΄μ¤‘
    
    λ©”μ„Έμ§€λ¥Ό μ „μ†΅ν•  λ• λ©”μ„Έμ§€ κ²½κ³„λ¥Ό λ…ν™•ν ν•μ—¬, μ „μ†΅λ κ° λ©”μ„Έμ§€κ°€ λ…λ¦½μ μΌλ΅ κµ¬λ¶„λ  μ μλ„λ΅ λ³΄μ¥ν•λ‹¤.
    

## μ‚¬μ© λ°©λ²•

μ‹λ‚λ¦¬μ¤

```mermaid
sequenceDiagram
    participant Client
    participant Server

    Client->>Server: HTTP μ”μ²­ (Upgrade: websocket)
    Server->>Client: HTTP μ‘λ‹µ (101 Switching Protocols)
    Note over Client,Server: WebSocket μ—°κ²° μλ¦½

    loop WebSocket ν†µμ‹ 
        Client->>Server: WebSocket λ©”μ‹μ§€ μ „μ†΅
        Server->>Client: WebSocket λ©”μ‹μ§€ μ „μ†΅
    end

    alt ν΄λΌμ΄μ–ΈνΈ μΆ…λ£
        Client->>Server: WebSocket Close ν”„λ μ„
        Server->>Client: WebSocket Close ν”„λ μ„ (ν™•μΈ)
    else μ„λ²„ μΆ…λ£
        Server->>Client: WebSocket Close ν”„λ μ„
        Client->>Server: WebSocket Close ν”„λ μ„ (ν™•μΈ)
    end

    Note over Client,Server: WebSocket μ—°κ²° μΆ…λ£

```

1. *(`if Protocal ==  wws`)μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°€ SSL/TLS ν•Έλ“μ„Έμ΄ν¬ (OSI Transport Layer)*
2. μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ κ°„μ μ›Ή μ†μΌ“ μ—°κ²° μ„¤μ •
3. λ°μ΄ν„°μ μ†΅μμ‹ 
4. μ—°κ²° μΆ…λ£

### 1. μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈμ μ—°κ²° λ° μλ½

<img width="320" alt="image" src="https://github.com/user-attachments/assets/399603c9-05d8-4116-9c54-dcb77c7b27df" />


- ν΄λΌμ΄μ–ΈνΈλ” WebSocket URLμ„ μ‚¬μ©ν•μ—¬ μ„λ²„μ— μ”μ²­
- WebSocket URLμ€ β€wsβ€(λΉ„μ•”νΈν™”) λλ” β€wwsβ€ (μ•”νΈν™”) ν”„λ΅ν† μ½μ„ HTTP/HTTPS λ€μ‹  μ‚¬μ©ν•λ‹¤.
    
    `ws://example.com:8000` , `wss://example.com:8000`
    
    <aside>
    π’΅ μ²« μ—°κ²°μ΄ `ws`κ°€ μ•„λ‹λΌ `HTTP`λ¥Ό μ΄μ©ν•΄μ„ μ”μ²­μ„ λ³΄λ‚Έλ‹¤κ³  ν•λ”λ°, `ws` ν”„λ΅ν† μ½μ„ μ‚¬μ©ν•λ”κ² λ§μ§€ μ•λ‚μ”?
    
    `WebSocket URL`μ„ μ μ„ λ• κΈ°μ΅΄ `http://`λ¥Ό λ³΄λ‚΄λ” κ³³μ— `ws` λ¥Ό μ‘μ„±ν•΄μ„ λ§μΉ OSI 7κ³„μΈµμ HTTP λ€μ‹  λ³„κ°μ ν”„λ΅ν† μ½μΈ ws ν”„λ΅ν† μ½μ„ μ‚¬μ©ν•λ” κ²ƒμ²λΌ λκ»΄μ§„λ‹¤.
    
    λ‹¤λ§, μ΄λ” ν‹€λ Έλ‹¤.
    
    `ws`λ” HTTP 1.1μ„ ν™•μ¥ν• λ°©μ‹μ΄λ©°, HTTP 1.1μ—μ„ λ‡κ°€μ§€ ν•„λ“λ“¤μ„ μ¶”κ°€ν•΄μ„ μ›Ή μ†μΌ“ λ°©μ‹μ„ κµ¬μ¶•ν•μ€λ‹¤.
    
    λ”°λΌμ„, μ›Ή μ†μΌ“μ„ μ‚¬μ©ν•λ” μ”μ²­μ„μ„ μ•λ¦¬κΈ° μ„ν• λ°©μ‹μ΄λΌκ³  μƒκ°ν•λ©΄ λλ‹¤. 
    
    </aside>
    
    <aside>
    π’΅ `ws` ν”„λ΅ν† μ½μ ν•Έλ“ μ„Έμ΄ν¬
    
    1. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—κ² Opening Handshakeλ¥Ό λ³΄λ‚Έλ‹¤.
    
    ```
    GET /chat HTTP/1.1
    Host: localhost:8080
    Upgrade: websocket
    Connection: Upgrade
    Sec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==
    Sec-WebSocket-Protocol: chat, superchat
    Sec-WebSocket-Version: 13
    Origin: http://localhost:9000
    ```
    
    1. HTTP 1.1λ΅ μ”μ²­μ΄ μ‚¬μ©λλ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.
    2. `Upgrade`: ν”„λ΅ν† μ½μ„ μ „ν™ν•κΈ° μ„ν•΄ μ‚¬μ©ν•λ” ν—¤λ”
        
        β†’ μ›Ή μ†μΌ“ μ”μ²­ μ‹μ—λ” λ°λ“μ‹ `websocket`μ΄λΌλ” κ°’μ„ κ°€μ§€λ©°, μ΄ κ°’μ΄ μ—†κ±°λ‚ λ‹¤λ¥Έ κ°’μ΄λ©΄ μ›Ήμ†μΌ“ μ ‘μ†μ„ μ¤‘μ§€
        
    3. `Connection`: ν„μ¬μ μ „μ†΅μ΄ μ™„λ£λ„λ‹ ν›„ λ„¤νΈμ›ν¬ μ ‘μ†μ„ μ μ§€ν•  κ²ƒμΈκ°€μ— λ€ν• μ •λ³΄
        
        β†’ μ›Ή μ†μΌ“ μ”μ²­ μ‹μ—λ” λ°λ“μ‹ `Upgrade` κ°’μ„ κ°€μ§€λ©°, λ§μ°¬κ°€μ§€λ΅ κ°’μ΄ μ—†κ±°λ‚ λ‹¤λ¥Έ κ°’μ΄λ©΄ μ›Ήμ†μΌ“ μ ‘μ†μ„ μ¤‘μ§€
        
    4. `Sec-WebSocket-Key`: μ ν¨ν• μ”μ²­μΈμ§€ ν™•μΈν•κΈ° μ„ν•΄ μ‚¬μ©λλ” μ„μ(Random)λ΅ μƒμ„±λ 1λ°”μ΄νΈ κ°’μ„ Base64λ΅ μΈμ½”λ”©ν• κ°’
    
    1. μ„λ²„μ μ›Ή μ†μΌ“ μ—…κ·Έλ μ΄λ“ μ‘λ‹µ
    
    ```
    HTTP/1.1 101 Switching Protocols
    Upgrade: websocket
    Connection: Upgrade
    Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
    ```
    
    1. HTTP 1.1λ΅ μ”μ²­
    2. 101 Response: Switching Protocol μ‘λ‹µμ½”λ“λ¥Ό μλ―Έ
    3. `Connection`: Upgrade λ” μ›Ή μ†μΌ“μΌλ΅ μ—…κ·Έλ μ΄λ“λ¥Ό ν™•μΈν•μ€λ‹¤λ” λ»
    4. `Sec-WebSocket-Accept`: ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚Έ `Sec-WebSocket-Key` λ¥Ό μ λ‹ν¬ IDλ¥Ό λ”ν•΄μ„ SHA-1λ΅ ν•΄μ‹±ν• ν›„, Base64λ΅ μΈμ½”λ”©ν• κ°’
        
        β†’ μ—°κ²°μ΄ κ°μ‹λμ—μμ„ μλ―Έν•¨.
        
    
    <aside>
    β“ 1. μ™ ws ν”„λ΅ν† μ½μ„ λ”°λ΅ λ§λ“¤μ§€ μ•κ³  HTTP κΈ°λ°μ—μ„ μ‚¬μ©ν–μ„κΉ? (ChatGPT λ€λ‹µ)
        
        β†’ κΈ°μ΅΄ μ›Ή μΈν”„λΌμ™€μ νΈν™μ„± μ μ§€
        
    - κΈ°μ΅΄μ— μ›Ή λΈλΌμ°μ €μ™€ μ›Ή μ„λ²„λ” **HTTP κΈ°λ°μ ν†µμ‹ λ§ μ§€μ›**ν–λ‹¤.
    - λ§μ•½ μ›Ή μ†μΌ“μ„ μ™„μ „ν λ…λ¦½μ μΈ ν”„λ΅ν† μ½λ΅ λ§λ“¤μ—λ‹¤λ©΄, μ΄λ¥Ό μ§€μ›ν•κΈ° μ„ν•΄ **μ›Ή μ„λ²„, λ°©ν™”λ²½, ν”„λ΅μ‹, λ΅λ“ λ°Έλ°μ„ λ“±μ μΈν”„λΌλ¥Ό μ „λ¶€ μμ •ν•΄μ•Ό ν–μ„ κ²ƒ**μ΄λ‹¤.
    - ν•μ§€λ§ HTTP κΈ°λ°μ—μ„ μ›Ή μ†μΌ“μ„ μ—…κ·Έλ μ΄λ“ν•λ” λ°©μ‹μΌλ΅ λ§λ“¤λ©΄, κΈ°μ΅΄ μΈν”„λΌμ™€μ **νΈν™μ„±μ΄ μ μ§€**λλ©°, μ„λ²„λ” μ›Ή μ†μΌ“μ„ μ§€μ›ν•μ§€ μ•λ” κ²½μ°μ—λ„ HTTP μ”μ²­μ„ μ •μƒμ μΌλ΅ μ²λ¦¬ν•  μ μλ‹¤.
    </aside>
    
    <aside>
    β“ 1. `Sec-WebSocket-Key`μ™€ `Sec-WebSocket-Accept`λ” λ¬΄μ¨ μ©λ„λ΅ μ‚¬μ©λλ”κ°€?
        [κ³µμ‹ λ¬Έμ„](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-WebSocket-Key)
    
    `Sec-WebSocket-Key`
    
    - HTTP ν΄λΌμ΄μ–ΈνΈλ¥Ό WebSocketμΌλ΅ μ—…κ·Έλ μ΄λ“ν•λ„λ΅ μ”μ²­ν•κΈ°λ¥Ό "μ •λ§λ΅" μ›ν•λ‹¤λ” κ²ƒμ„ ν™•μΈν•κΈ° μ„ν• ν•„λ“
    - μ΄λ•, ν΄λΌμ΄μ–ΈνΈκ°€ λ³΄λ‚΄λ” Sec-WebSocket-Key ν‚¤μ κ°’μ€ WebSocket μ‚¬μ–‘μ— μ •μλ μ•κ³ λ¦¬μ¦μ„ μ‚¬μ©ν•μ—¬ κ³„μ‚°λλ―€λ΅Β *λ³΄μ•μ„ μ κ³µν•μ§€ μ•μµλ‹λ‹¤*.
    
    `Sec-WebSocket-Accept`
    
    - μ„λ²„κ°€ μ›Ήμ†μΌ“ μ—°κ²°μ„ μ‹μ‘ν•  μν–¥μ„ μ•λ¦¬κΈ° μ„ν•΄ μ„λ²„μ—μ„ ν΄λΌμ΄μ–ΈνΈλ΅ μ „μ†΅ν•λ” ν—¤λ”
    - κ·Έμ € `258EAFA5-E914-47DA-95CA-C5AB0DC85B11`μ„ λ§λ¶™μ΄κ³ , μƒ κ°’μ SHA-1 κ°’μ„ κ°€μ Έμ¨ λ‹¤μ,Β [base64](https://developer.mozilla.org/ko/docs/Glossary/Base64)λ΅ μΈμ½”λ”©
        - κΈ°λ¥μ΄ κµ¬ν„λμ–΄ μλ‹¤λ©΄ λ„κµ¬λ‚ λ§λ“¤μ μλ” κ°’
    
    β…Β κ°μΈμ μΌλ΅λ” μ†μΌ“μ΄ λ„¤νΈμ›ν¬ μ‚¬μ©λ‰μ΄ λ§κ³  μ»΄ν“¨ν„°μ— λ¶€ν•κ°€ λ§μ΄κ°€μ„, λ‹¤μ‹ν•λ² ν™•μΈν•λ”κ² μ•„λ‹κΉ μ‹¶μµλ‹λ‹¤.
    
    </aside>
    
    <aside>
    β“ 1. `Sec-WebSocket-Key`μ™€ `Sec-WebSocket-Accept`λ” κ°λ°μκ°€ μ„¤μ •ν•΄μ•Ό ν•λ” κ°’μΈκ°€?? μ„¤μ •ν•λ” κ²ƒμ„ λ³Έμ μ΄ μ—†λ”λ°..?
    
    [μ›Ήμ†μΌ“ API](https://developer.mozilla.org/ko/docs/Web/API/WebSocket)Β λλ” μ›Ήμ†μΌ“μ„ μ‚¬μ©ν•λ” λ‹¤λ¥Έ λΌμ΄λΈλ¬λ¦¬λ¥Ό μ‚¬μ©ν•΄μ„ μƒλ΅μ΄ μ—°κ²°μ„ μ—΄κ² λλ‹¤λ©΄ μ΄λ¬ν• κ³Όμ • λ€λ¶€λ¶„ λλ” μ „λ¶€κ°€ μ²λ¦¬λλ‹¤
    
    ```jsx
    const webSocket = new WebSocket("ws://destination.server.ext", "optionalProtocol");
    ```
    
    </aside>
    
    <aside>
    β“ 1. 100λ²λ€ μ‘λ‹µμ½”λ“
    
    1λ²λ€ μ‘λ‹µμ½”λ“λ” μ •λ³΄(Information)λ¥Ό λ‚νƒ€λ‚΄λ” μ‘λ‹µ μ½”λ“λ΅, ν΄λΌμ‰λ„νΈκ°€ λ³΄λ‚Έ μ”μ²­μ„ μ„λ²„κ°€ μ²λ¦¬ν•κ³  μμμ„ μλ―Έν•¨. (β μ²λ¦¬ν•¨)
    
    </aside>
    
    <aside>
    β“ HTTP 3κΉμ§€ λ‚μ™”λ”λ° HTTP 1.1μ„ μ‚¬μ©ν•λ” μ΄μ ?
    
    1. HTTP/2λ” μ΄ λ©”μ»¤λ‹μ¦μ μ‚¬μ©μ„ λ…μ‹μ μΌλ΅ ν—μ©ν•μ§€ μ•κ³ , HTTP/1.1μ—μ„λ§ λ…μ‹μ μΌλ΅ ν—μ©
    2. μ—¬μ „ν λ§μ€ μ›Ή μ• ν”λ¦¬μΌ€μ΄μ…μ΄ HTTP 1.1μ„ μ‚¬μ©ν•λ‹¤.
        
        HTTP 3 λ¶€ν„°λ” UDP κΈ°λ°μ΄μ–΄μ„ μ•„μ§ μ™„μ „ν ν‘μ¤€μΌλ΅ μλ¦¬μ΅μ§€ λ»ν–λ‹¤.
        
    </aside>
    
    </aside>
    
    <aside>
    π’΅ `ws` μ™€ `wss`μ μ°¨μ΄
    
    `wss`μ λ§μ§€λ§‰ sλ” secureμ μ•½μλ΅, TLS/SSLμ„ μ μ©ν•λ‹¤λ” κ²ƒμ„ μλ―Έν•λ‹¤.
    
    β…Β TLSμ™€ TCPλ” λ‹¤λ¥Έ κ³„μΈµμ λ‹¤λ¥Έ μ—­ν• μ„ μν–‰ν•©λ‹λ‹¤. (ν—·κ°λ¦¬μ§€ λ§κ²ƒ)
    
    <img width="324" alt="image" src="https://github.com/user-attachments/assets/f4fc0fcf-798d-4a54-9850-3d014210e8cf" />
    
    </aside>
    

### 2. λ°μ΄ν„°μ μ†΅μμ‹ 

<img width="313" alt="image" src="https://github.com/user-attachments/assets/fee5356c-62dc-46ac-a3dd-2d0600af85b1" />

- μ—°κ²°μ΄ μ„¤μ •λλ©΄ μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈλ” μ–‘λ°©ν–¥μΌλ΅ λ©”μ‹μ§€λ¥Ό μμ λ΅­κ² μ£Όκ³ λ°›μ„ μ μμµλ‹λ‹¤.
- μ΄ λ• λ©”μ‹μ§€λ” ν”„λ μ„ ν•νƒλ΅ μ „μ†΅λλ©°, μ΄λ¥Ό ν†µν•΄ ν° λ°μ΄ν„°λ„ λ¶„ν• ν•μ—¬ μ „μ†΅ν•  μ μμµλ‹λ‹¤.

<aside>
π’΅ μ†μΌ“μ€ Full-Duplex(μ „μ΄μ¤‘) λ°©μ‹μΌλ΅ ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ λΏλ§ μ•„λ‹λΌ, μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈλ΅μ ν¨ν‚· μ „μ†΅λ„ κ°€λ¥ν•λ‹¤.

- HTTPλ” Half-Duplex(λ°μ΄μ¤‘) λ°©μ‹μ΄λ‹¤.
</aside>

### 3. μ—°κ²° μΆ…λ£ (μ»¤λ„¥μ… λ‹«κΈ°)

<img width="261" alt="image" src="https://github.com/user-attachments/assets/1fc10926-abb4-405d-9fec-170b970f0c39" />

Aμ™€ Bκ°€ μ†μΌ“ μ—°κ²°λμ–΄ μλ‹¤κ³  κ°€μ •ν•κ² μµλ‹λ‹¤.

1. μ—°κ²° μ£Όμ²΄ (λΈλΌμ°μ €λ‚ μ„λ²„) μ¤‘ ν•μ½(A)μ—μ„ μ»¤λ„·μ… λ‹«κΈ°(close)λ¥Ό μ›ν•λ” κ²½μ°μ—” λ³΄ν†µ μ«μλ΅ λ μ½”λ“μ™€ λ¬Έμλ΅ λ μ‚¬μ κ°€ λ‹΄κΈ΄ 'μ»¤λ„¥μ… μΆ…λ£ ν”„λ μ„β€™μ„ μ „μ†΅ν•κ² λ©λ‹λ‹¤.
2. λ‹¤λ¥Έ ν•μ½(B)μ—μ„ μ”μ²­ λ°›μ€ Close ν”„λ μ„μ— λ€ν• ν™•μΈ μ‘λ‹µμ„ λ³΄λƒ…λ‹λ‹¤.
3. μ΄ν›„, λ‹¤λ¥Έ ν•μ½ (B)μ—μ„λ„ μ†μΌ“μ„ λ‹«κΈ° μ„ν• Close ν”„λ μ„μ„ Aμ—κ² μ „λ‹¬ν•©λ‹λ‹¤.
4. Aλ” μ΄λ¥Ό λ°›μ•„, μ‘λ‹µμ„ λ³΄λƒ…λ‹λ‹¤

<img width="379" alt="image" src="https://github.com/user-attachments/assets/5d4ce029-f2f9-464b-a29f-1206d611f9ce" />

1. ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ—κ² `FIN` μ„Έκ·Έλ¨ΌνΈλ¥Ό μ „μ†΅ν•λ‹¤.
    - ν΄λΌμ΄μ–ΈνΈλ” μΆ…λ£ μ‘λ‹µμ„ κΈ°λ‹¤λ¦°λ‹¤λ” μλ―Έλ΅ `FIN-WAIT1` μƒνƒλ΅ μ ‘μ–΄λ“¤κ² λλ‹¤.
        - `FIN-WAIT1` : μ†μΌ“μ΄ ν”„λ΅μ„Έμ¤λ΅λ¶€ν„° νμλμ–΄ μ»¤λ„μ΄ μ²λ¦¬ν•λ” λ‹¨κ³„μ— μ§„μ…ν• μƒνƒ `(ophan socket)`
2. μ„λ²„λ” μ‘λ‹µμ„ λ°›μ€ ν›„, ν΄λΌμ΄μ–ΈνΈμ—κ² μμ‹ μ μ†μΌ“ ν”„λ΅μ„Έμ¤ μΆ…λ£λ¥Ό μ”μ²­ν•λ©° κΈ°λ‹¤λ¦¬λ” `CLOSE-WAIT` μƒνƒμ— μ ‘μ–΄λ“ λ‹¤.
    - `CLOSE-WAIT` μƒνƒλ” λ‚΄λ¶€ μ†μΌ“ μΆ…λ£μ‹κΉμ§€ μ κΉ μ μ§€λλ‹¤. (ν”„λ΅μ„Έμ¤ νμ)
        - `FIN` μ„ λ°›μ•λ”λΌλ„, μ•„μ§ λ³΄λ‚΄μ•Όν•  λ°μ΄ν„°κ°€ μλ‹¤λ©΄ μ΄λ¥Ό λ³΄λ‚΄κ³  μ†μΌ“μ„ μΆ…λ£ν•΄μ•Ό ν•κΈ° λ•λ¬Έμ— ν…€μ΄ μ΅΄μ¬ν•λ‹¤.
    
    λν•, μ„λ²„λ” μΆ…λ£ μ‹ νΈλ¥Ό λ°›μ•„ λ‚΄λ¶€μ μΌλ΅ μ†μΌ“μ„ μΆ…λ£ν•κ² λ‹¤λ” μλ―Έλ΅ `FIN`μ— λ€ν• `ACK`μ„ λ³΄λ‚Έλ‹¤.
    
    <aside>
    β” μ„λ²„κ°€ μ „μ†΅ν• ACKκ°€ λ¨μΆ…μ μ΄μ λ΅ κ³„μ† ν΄λΌμ΄μ–ΈνΈμ— μ•μ¤λ©΄ `orphan socket`μ΄ κ³„μ† μ“μ΄λ‚μ”?
    
    - `net.ipv.tcp_orphan_retires` λΌλ” μ»¤λ„ νλΌλ―Έν„°κ°€ μ΅΄μ¬ν•λ‹¤. μ΄λ”, FINμ„ μ¬μ „μ†΅ν•  νμλ¥Ό μ§€μ •ν•κ² λλ‹¤.
    β†’ 87λ΅ μ„¤μ •ν•λ©΄ κΈ°λ³Έ μ „μ†΅ 1ν + μ¬μ „μ†΅ 7νλ¥Ό μ‹λ„ν•λ‹¤.
    </aside>
    
3. ACKλ¥Ό λ°›μ€ ν΄λΌμ΄μ–ΈνΈλ” μΆ…λ£ μ‹ νΈλ¥Ό μμ‹ ν–λ‹¤λ” μ„Έκ·Έλ¨ΌνΈλ¥Ό μ „λ‹¬λ°›μ•μΌλ―€λ΅, μ„λ²„μ μ†μΌ“ μΆ…λ£μ‹ νΈλ¥Ό κΈ°λ‹¤λ¦¬λ” `FIN-WAIT2` μƒνƒλ΅ μ ‘μ–΄λ“¤κ² λλ‹¤.

---

1. μ„λ²„κ°€ μ†μΌ“μ΄ μ •μƒμ μΌλ΅ μΆ…λ£λλ©΄ μ΄λ¥Ό ν΄λΌμ΄μ–ΈνΈμ—κ² μ•λ ¤μ£Όκ³ μ `FIN` μ‹ νΈλ¥Ό λ³΄λ‚΄κ² λλ‹¤.
    - μ„λ²„λ” μ •μƒμ μΌλ΅ μΆ…λ£ν–μμ„ λ‚νƒ€λ‚΄λ” `LAST-ACK`  μƒνƒκ°€ λλ‹¤.
    
    <aside>
    β” μ„λ²„μ λ§μ§€λ§‰ FINμ— λ€ν• ACKλ¥Ό λ¨μΆ…μ μ΄μ λ΅ μ „λ‹¬λ°›μ§€ λ»ν•λ©΄ μ–΄λ–΅ν•λ‚μ”?
    
    μ„λ²„λ” μΌμ • μ‹κ°„ λ™μ• FINμ— λ€ν• ACKλ¥Ό λ°›μ§€ λ»ν•λ” κ²½μ°, λ³ΈμΈμ FIN ν¨ν‚·μ„ μ¬μ „μ†΅ν•©λ‹λ‹¤.
    
    </aside>
    
2. ν΄λΌμ΄μ–ΈνΈλ” μ†μΌ“μ„ μ™„μ „ν μΆ…λ£ν•λ‹¤λ” ACKλ¥Ό μ„λ²„μ— λ³΄λƒ…λ‹λ‹¤.
    - ν΄λΌμ΄μ–ΈνΈλ” TIME-WAIT μƒνƒκ°€ λλ‹¤.
    
    <aside>
    β” μ„λ²„κ°€ λ§μ§€λ§‰ ACKλ¥Ό λ¨μΆ…μ μ΄μ λ΅ λ»λ°›μΌλ©΄ μ–΄λ–»κ² ν•λ‚μ”?
    
    ν΄λΌμ΄μ–ΈνΈλ” λ§μ§€λ§‰ ACKλ¥Ό λ³΄λ‚΄κ³  TIME-WAIT μƒνƒκ°€ λ©λ‹λ‹¤.
    
    ν•΄λ‹Ή μƒνƒλ” 2 * MSL (Maximum Segment Lifetime) λ§νΌ μ μ§€λλ©°, μ„λ²„κ°€ FIN ν¨ν‚·μ„ μ¬μ „μ†΅ν–μ„ λ•λ” λ€λΉ„ν•λ” μƒνƒλΌκ³  μƒκ°ν•μ‹λ©΄ λ©λ‹λ‹¤.
    
    </aside>
    

<aside>
π’΅ λ¨Όμ € μ—°κ²° ν•΄μ λ¥Ό μ‹λ„ν•λ” μ½μ—μ„λ” TIME_WAIT μƒνƒμ— λμ…ν•©λ‹λ‹¤. μ΄λ¬ν• μ†μΌ“μ΄ κ³„μ† μƒκ²¨λ‚λ©΄ λ¬Έμ κ°€ λ°μƒν•μ§€ μ•λ‚μ”?

λ„¤

λ¨Όμ €, μ†μΌ“μ€ ν΄λΌμ΄μ–ΈνΈ IP + ν¬νΈ + μ„λ²„ IP + ν¬νΈ ν•λ‚λ¥Ό μ μ ν•κ³  μ‚¬μ©ν•κ² λ©λ‹λ‹¤.

β†’ λ΅μ»¬ ν¬νΈκ°€ κ³ κ°λκ² λλ” κ²½μ°κ°€ λ°μƒν•  μ μλ‹¤.

ν•΄κ²° λ°©λ²•

- μ»¤λ„μ  `net.ipv4.tcp_tw_resuse` νλΌλ―Έν„°λ΅ TIME_WAIT μƒνƒμ μ†μΌ“ μ¤‘ ν”„λ΅ν† μ½μƒ μ‚¬μ©ν•΄λ„ λ¬΄λ°©ν•΄ λ³΄μ΄λ” μ†μΌ“μ„ μ¬μ‚¬μ©ν•λ‹¤.
- Connection Pool μ„ ν†µν•΄ μ—°κ²°μ„ μ§€μ†μ μΌλ΅ μ μ§€ λ° κ΄€λ¦¬ν•λ‹¤.
- μ»¤λ„¥μ… `Keep-Alive` μ„¤μ •
    - μΆ€λΉ„ μ†μΌ“μ΄ λμ§€ μ•λ„λ΅ μ£Όμν•΄μ•Ό ν•λ‹¤.
</aside>

### ν”„λ μ„κ°„ κ²½κ³„λ¥Ό μλ―Έν•λ” FINκ³Ό μ†μΌ“ μ»¤λ„¥μ… μΆ…λ£μ— μ‚¬μ©λλ” FINμ€ κ°™μ€ FINμΈκ°€??

μ•„λ‹λ‹¤.

1. ν”„λ μ„κ°„ κ²½κ³„λ¥Ό μλ―Έν•λ” FIN λΉ„νΈλ” β€μ΄ ν”„λ μ„μ΄ λ©”μ„Έμ§€μ λ§μ§€λ§‰ ν”„λ μ„μΈμ§€ μ—¬λ¶€β€λ¥Ό μλ―Έν•©λ‹λ‹¤.
- FIN = 1 : ν•΄λ‹Ή ν”„λ μ„μ΄ λ©”μ„Έμ§€μ λ§μ§€λ§‰ ν”„λ μ„μ„μ„ μλ―Έ
- FIN = 0 : λ©”μ„Έμ§€κ°€ μ•„μ§ λλ‚μ§€ μ•μ•μΌλ©°, μ¶”κ°€ ν”„λ μ„μ΄ μ΄μ–΄μ§μ„ μλ―Έ

1. TCPμ—μ„μ FIN ν”λκ·Έλ” β€μ΄μ  λ” μ΄μƒ λ°μ΄ν„°λ¥Ό λ³΄λ‚΄μ§€ μ•κ² λ‹¤. TCP μ—°κ²°μ„ ν•΄μ ν•μβ€λ” λ»μ΄λ‹¤.
- 4-Way Handshake κ³Όμ •μ„ ν†µν•΄ μν–‰λλ‹¤.

OSI κ³„μΈµμ κ΄€μ μ—μ„ μ‚΄ν΄λ³΄λ©΄ λ” λ…ν™•ν•λ‹¤.

WebSocket ν”„λ΅ν† μ½μ€ 7κ³„μΈµ Application Layerμ— ν•΄λ‹Ήν•κ³ , TCPλ” 4κ³„μΈµ Transport Layerμ— ν•΄λ‹Ήν•λ―€λ΅, μ™„μ „ν λ‹¤λ¥Έ FINκ°’μ΄λ‹¤.
